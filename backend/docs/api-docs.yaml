swagger: "2.0"
info:
  version: "1.0.0"
  title: Digital Stories API
  description: This is an API made with Express for the MERN stack Digital Stories application.
  contact:
    email: abdullah.tahir.skipq@gmail.com
host: localhost:5544
basePath: /api
schemes:
  - http
paths:
  /me:
    get:
      tags: ["Users"]
      summary: returns the details of currently logged-in user
      produces:
        - application/json
      parameters:
        - name: accessToken
          in: cookie
          required: true
          schema:
            type: object
            properties:
              accessToken:
                type: string
                description: Valid JSON Web Token (JWT) for authentication
      responses:
        200:
          description: Successful response
          schema:
            $ref: "#/definitions/UserDetails"
        401:
          description: Expired JSON Web Token (JWT)
        500:
          description: Internal server error
  /getNumUsers:
    get:
      tags: ["Users"]
      summary: returns the number of users registered in the app
      produces:
        - application/json
      parameters:
        - name: accessToken
          in: cookie
          required: true
          schema:
            type: object
            properties:
              accessToken:
                type: string
                description: Valid JSON Web Token (JWT) for authentication
      responses:
        200:
          description: Successful response
          schema:
            type: object
            properties:
              numUsers:
                type: number
                description: number of users registered in the app
        401:
          description: Expired JSON Web Token (JWT)
        500:
          description: Internal server error
  /comment:
    post:
      tags: ["Comments"]
      summary: create a new comment
      produces:
        - application/json
      parameters:
        - name: accessToken
          in: cookie
          required: true
          schema:
            type: object
            properties:
              accessToken:
                type: string
                description: Valid JSON Web Token (JWT) for authentication 
        - in: body
          name: body
          required: true
          schema:
            type: object
            properties:
              text:
                type: string
                required: true
              user:
                type: string
                pattern: "^[0-9a-fA-F]{24}$"
                required: true
              story:
                type: string
                pattern: "^[0-9a-fA-F]{24}$"
                required: true
      responses:
        201:
          description: Comment posted successfully
        401:
          description: Expired JSON Web Token (JWT)
        422:
          description: Invalid request body
        500:
          description: Internal server error
  /comments/{id}:
    get:
      tags: ["Comments"]
      summary: get comments by Story ID
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          pattern: "^[0-9a-fA-F]{24}$"
        - name: accessToken
          in: cookie
          required: true
          schema:
            type: object
            properties:
              accessToken:
                type: string
                description: Valid JSON Web Token (JWT) for authentication 
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              text:
                type: string
                required: true
              user:
                type: string
                pattern: "^[0-9a-fA-F]{24}$"
                required: true
              story:
                type: string
                pattern: "^[0-9a-fA-F]{24}$"
                required: true
      responses:
        200:
          description: Successful response
          schema:
            $ref: "#/definitions/PostComments"
        401:
          description: Expired JSON Web Token (JWT)
        404:
          description: Comment not found
        500:
          description: Internal server error
  
  /register:
    post:
      tags:
        - ["Auth"]
      summary: "register a new user"
      produces:
        - application/json
      parameters:
          - name: "name"
            in: "body"
            type: "string"
            maxLength: 30
            required: true
          - name: "username"
            in: "body"
            type: "string"
            maxLength: 20
            required: true
          - name: "email"
            in: "body"
            type: "string"
            format: "email"
            required: true
          - name: "password"
            in: "body"
            type: "string"
            pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$"
            required: true
          - name: "confirmPassword"
            in: "body"
            type: "string"
            required: true
          - name: "avatarPath"
            in: "body"
            type: "string"
      responses:
        201:
          description: "user registered successfully"
          schema:
            $ref: "#/definitions/UserDetails"
        422:
          description: Invalid request body
        500:
          description: Internal server error
  /login:
    post:
      tags:
        - ["Auth"]
      summary: "login a user"
      produces: "application/json"
      parameters:
        - username:
          type: "string"
          minLength: 5
          maxLength: 15
          required: true
        - password:
          type: "string"
          pattern: "^[a-zA-Z0-9]{8,25}$"
          required: true
      responses:
        200:
          description: "user logged in successfully"
          schema:
            $ref: "#/definitions/UserDetails"
        422:
          description: "Invalid request body"
        401:
          description: "Wrong credentials"
        500:
          description: "Internal server error"
  /refresh:
    post:
      summary: refresh access token
      description: Use the refresh token to get a new access token
      tags:
      - ["Auth"]
      parameters:
          - name: accessToken
            in: cookie
            required: true
            schema:
              type: object
              properties:
                accessToken:
                  type: string
                  description: Valid JSON Web Token (JWT) for authentication
      responses:
          200:
            description: "user logged in successfully"
            schema:
              $ref: "#/definitions/UserDetails"
          401:
            description: "Expired JSON Web Token (JWT)"
          500:
            description: "Internal server error"
  /logout:
    post:
      tags:
      - ["Auth"]
      summary: logout the user
      parameters:
          - name: accessToken
            in: cookie
            required: true
            schema:
              type: object
              properties:
                accessToken:
                  type: string
                  description: Valid JSON Web Token (JWT) for authentication  
      responses:
        200:
          description: Successful logout
          schema:
            $ref: "#/definitions/LogOutUser"  
        500:
          description: Internal server error
  /engagements/{id}:
    get:
      tags:
        - [Engagements]
      summary: Retrieve engagement details by user ID
      parameters:
        - name: id
          in: path
          description: ID of the user
          required: true
          type: string

        - name: accessToken
          in: cookie
          required: true
          schema:
            type: object
            properties:
              accessToken:
                type: string
                description: Valid JSON Web Token (JWT) for authentication
      responses:
        200:
          description: Successful response
          schema:
            $ref: "#/definitions/Engagement"
        404:
          description: User not found
  /leaderboard:
    get:
      tags:
        - Leaderboard
      summary: Retrieve leaderboard data
      parameters:
        - name: accessToken
          in: cookie
          required: true
          schema:
            type: object
            properties:
              accessToken:
                type: string
                description: Valid JSON Web Token (JWT) for authentication
      responses:
        200:
          description: Successful response
          schema:
            $ref: "#/definitions/Leaderboard"
          

definitions:
  UserDetails:
    type: object
    properties:
      _id:
        type: string
        description: Unique identifier for the user
      name:
        type: string
        description: User's name
      username:
        type: string
        description: User's username
      avatar:
        type: string
        description: URL to user's avatar
      memberSince:
        type: string
        description: Time passed since the user joined the app
      auth:
        type: boolean
        default: true
        description: Authentication status of user
  PostComments:
    type: object
    properties:
      comments:
        type: array
        items:
          type: object
          properties:
            _id:
              type: string
              pattern: "^[0-9a-fA-F]{24}$"
            text:
              type: string
            username:
              type: string
            avatarPath:
              type: string
            postedAt:
              type: string
              format: "date-time"
  LogOutUser:
    type: object
    properties:
      user:
        type: null
        default: null
      auth:
        type: boolean
        default: false
  EngagementDTOYou:
    type: object
    properties:
      action:
        type: string
        example: commented
      username:
        type: string
        example: primalTraits
      onStory:
        type: string
        format: ObjectId
        example: 63c4eb887a63b31be48cff87
      date:
        type: string
        format: date-time
        example: "2023-01-16T06:17:00.961Z"
      key:
        type: string
        format: ObjectId
        example: 63c4ebdc7a63b31be48d00da
      goal:
        type: string
        example: anotherUser
  EngagementDTOOthers:
    type: object
    properties:
      action:
        type: string
        example: downvoted
      username:
        type: string
        example: john
      onStory:
        type: string
        format: ObjectId
        example: 63bae0ff4f44f7ff64a7ae75
      date:
        type: string
        format: date-time
        example: "2023-01-14T21:07:48.534Z"
      key:
        type: string
        format: ObjectId
        example: 63c319a44907cc28be6bb5a2
      goal:
        type: string
        example: primalTraits
  Engagement:
    type: object
    properties:
      you:
        type: array
        items:
          $ref: "#/definitions/EngagementDTOYou"
      others:
        type: array
        items:
          $ref: "#/definitions/EngagementDTOOthers"
  LeaderboardDTO:
    type: object
    properties:
      username:
        type: string
      avatar:
        type: string
      storyCount:
        type: integer
      upVoteCount:
        type: integer
  Leaderboard:
    type: object
    properties:
      leaderboard:
        type: array
        items:
          $ref: "#/definitions/LeaderboardDTO"

